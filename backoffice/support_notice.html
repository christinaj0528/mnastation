<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<title>공지사항 관리 | M&A STATION</title>
<link rel="stylesheet" href="https://macomaex.com/backoffice/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://macomaex.com/backoffice/build/css/custom.min.css" rel="stylesheet">
<style>
  .admin-container {
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
  }
  .board-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  .btn-primary {
    background: #4db7ff;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
  }
  .board-table {
    width: 100%;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .board-table th {
    background: #f5f5f5;
    padding: 15px;
    text-align: left;
    font-weight: 600;
  }
  .board-table td {
    padding: 15px;
    border-top: 1px solid #eee;
  }
  .board-table tr:hover {
    background: #f9f9f9;
  }
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    overflow-y: auto;
    padding: 20px;
  }
  .modal-content {
    background: white;
    max-width: 800px;
    margin: 0 auto;
    padding: 30px;
    border-radius: 12px;
  }
  .form-group {
    margin-bottom: 20px;
  }
  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
  }
  .form-group input,
  .form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
  }
  .form-group textarea {
    min-height: 200px;
    resize: vertical;
  }
  .form-group input[type="checkbox"] {
    width: auto;
    margin-right: 8px;
  }
  .file-preview {
    margin-top: 10px;
    padding: 10px;
    background: #f9f9f9;
    border-radius: 6px;
    font-size: 12px;
  }
  .file-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    border-bottom: 1px solid #eee;
  }
  .file-item:last-child {
    border-bottom: none;
  }
  .file-item-name {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .file-item-remove {
    color: #ff5757;
    cursor: pointer;
    margin-left: 10px;
  }
</style>
</head>
<body>
  <div class="admin-container">
    <div class="board-header">
      <h2>공지사항 관리</h2>
      <button class="btn-primary" onclick="openAddModal()">+ 새 공지사항 등록</button>
    </div>

    <table class="board-table">
      <thead>
        <tr>
          <th style="width: 80px;">번호</th>
          <th>제목</th>
          <th style="width: 100px;">중요</th>
          <th style="width: 150px;">작성일</th>
          <th style="width: 120px;">관리</th>
        </tr>
      </thead>
      <tbody id="noticeList">
        <tr>
          <td colspan="5" style="text-align: center; padding: 40px;">등록된 공지사항이 없습니다.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 등록/수정 모달 -->
  <div id="noticeModal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitle">새 공지사항 등록</h3>
      <form id="noticeForm" onsubmit="saveNotice(event)">
        <input type="hidden" id="noticeId">
        <div class="form-group">
          <label>
            <input type="checkbox" id="noticeIsImportant"> 중요 공지사항
          </label>
        </div>
        <div class="form-group">
          <label>제목 *</label>
          <input type="text" id="noticeTitle" required>
        </div>
        <div class="form-group">
          <label>내용 *</label>
          <textarea id="noticeContent" required></textarea>
        </div>
        <div class="form-group">
          <label>첨부 파일</label>
          <input type="file" id="noticeAttachment" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.jpg,.jpeg,.png,.gif">
          <div id="noticeAttachmentList" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button type="button" onclick="closeModal()" style="padding: 10px 20px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer;">취소</button>
          <button type="submit" class="btn-primary">저장</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const NOTICE_STORAGE_KEY = 'mna_station_notices';

    function loadNotices() {
      const notices = JSON.parse(localStorage.getItem(NOTICE_STORAGE_KEY) || '[]');
      const tbody = document.getElementById('noticeList');
      
      if (notices.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px;">등록된 공지사항이 없습니다.</td></tr>';
        return;
      }

      // 최신순 정렬 (중요 공지는 상단에)
      notices.sort((a, b) => {
        if (a.isImportant && !b.isImportant) return -1;
        if (!a.isImportant && b.isImportant) return 1;
        return new Date(b.createdAt || b.updatedAt) - new Date(a.createdAt || a.updatedAt);
      });

      tbody.innerHTML = notices.map((item, index) => {
        const date = new Date(item.createdAt || item.updatedAt).toLocaleDateString('ko-KR');
        return `
          <tr>
            <td>${notices.length - index}</td>
            <td>${item.isImportant ? '<span style="color: #ff5757; font-weight: 600;">[중요]</span> ' : ''}${item.title || '(제목 없음)'}</td>
            <td>${item.isImportant ? '✓' : ''}</td>
            <td>${date}</td>
            <td>
              <button onclick="editNotice('${item.id}')" style="padding: 5px 10px; background: #4db7ff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px;">수정</button>
              <button onclick="deleteNotice('${item.id}')" style="padding: 5px 10px; background: #ff5757; color: white; border: none; border-radius: 4px; cursor: pointer;">삭제</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    let uploadedFiles = [];

    function updateAttachmentList() {
      const list = document.getElementById('noticeAttachmentList');
      if (uploadedFiles.length === 0) {
        list.innerHTML = '';
        return;
      }
      list.innerHTML = '<div class="file-preview"><strong>첨부된 파일:</strong>' + 
        uploadedFiles.map((file, index) => `
          <div class="file-item">
            <span class="file-item-name">${file.name} (${formatFileSize(file.size)})</span>
            <span class="file-item-remove" onclick="removeAttachment(${index})">삭제</span>
          </div>
        `).join('') + '</div>';
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    function removeAttachment(index) {
      uploadedFiles.splice(index, 1);
      updateAttachmentList();
    }

    document.getElementById('noticeAttachment').addEventListener('change', function(e) {
      const files = Array.from(e.target.files);
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
          uploadedFiles.push({
            name: file.name,
            type: file.type,
            size: file.size,
            data: e.target.result
          });
          updateAttachmentList();
        };
        reader.readAsDataURL(file);
      });
      e.target.value = '';
    });

    function openAddModal() {
      document.getElementById('noticeId').value = '';
      document.getElementById('noticeTitle').value = '';
      document.getElementById('noticeContent').value = '';
      document.getElementById('noticeIsImportant').checked = false;
      document.getElementById('noticeAttachment').value = '';
      uploadedFiles = [];
      updateAttachmentList();
      document.getElementById('modalTitle').textContent = '새 공지사항 등록';
      document.getElementById('noticeModal').style.display = 'block';
    }

    function editNotice(id) {
      const notices = JSON.parse(localStorage.getItem(NOTICE_STORAGE_KEY) || '[]');
      const item = notices.find(n => n.id === id);
      if (!item) return;

      document.getElementById('noticeId').value = id;
      document.getElementById('noticeTitle').value = item.title || '';
      document.getElementById('noticeContent').value = item.content || '';
      document.getElementById('noticeIsImportant').checked = item.isImportant || false;
      document.getElementById('noticeAttachment').value = '';
      uploadedFiles = item.attachments || [];
      updateAttachmentList();
      document.getElementById('modalTitle').textContent = '공지사항 수정';
      document.getElementById('noticeModal').style.display = 'block';
    }

    function saveNotice(event) {
      event.preventDefault();
      const notices = JSON.parse(localStorage.getItem(NOTICE_STORAGE_KEY) || '[]');
      const id = document.getElementById('noticeId').value;
      
      const noticeData = {
        id: id || 'notice_' + Date.now(),
        title: document.getElementById('noticeTitle').value,
        content: document.getElementById('noticeContent').value,
        description: document.getElementById('noticeContent').value.substring(0, 100),
        isImportant: document.getElementById('noticeIsImportant').checked,
        attachments: uploadedFiles.length > 0 ? uploadedFiles : undefined,
        views: id ? (notices.find(n => n.id === id)?.views || 0) : 0,
        createdAt: id ? notices.find(n => n.id === id).createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };

      if (id) {
        const index = notices.findIndex(n => n.id === id);
        if (index !== -1) {
          notices[index] = noticeData;
        }
      } else {
        notices.push(noticeData);
      }

      localStorage.setItem(NOTICE_STORAGE_KEY, JSON.stringify(notices));
      loadNotices();
      closeModal();
      alert('저장되었습니다.');
    }

    function deleteNotice(id) {
      if (!confirm('정말 삭제하시겠습니까?')) return;
      
      const notices = JSON.parse(localStorage.getItem(NOTICE_STORAGE_KEY) || '[]');
      const filtered = notices.filter(n => n.id !== id);
      localStorage.setItem(NOTICE_STORAGE_KEY, JSON.stringify(filtered));
      loadNotices();
      alert('삭제되었습니다.');
    }

    function closeModal() {
      document.getElementById('noticeModal').style.display = 'none';
    }

    document.getElementById('noticeModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    loadNotices();
  </script>
</body>
</html>

