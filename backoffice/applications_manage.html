<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì‹ ì²­ ê´€ë¦¬ - M&A STATION</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Malgun Gothic", "Apple SD Gothic Neo", sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 30px;
    }

    h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #4db7ff;
    }

    .filter-section {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-group label {
      font-size: 14px;
      color: #666;
      white-space: nowrap;
    }

    .filter-group select,
    .filter-group input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .filter-group input {
      min-width: 200px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #4db7ff;
      color: white;
    }

    .btn-primary:hover {
      background: #1f6fe5;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    thead {
      background: #f8f9fa;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #dee2e6;
    }

    th {
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    td {
      font-size: 13px;
      color: #666;
    }

    tbody tr:hover {
      background: #f8f9fa;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-waiting {
      background: #fff3cd;
      color: #856404;
    }

    .status-processing {
      background: #d1ecf1;
      color: #0c5460;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    .status-cancelled {
      background: #f8d7da;
      color: #721c24;
    }

    .type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .type-buyer {
      background: #cfe2ff;
      color: #084298;
    }

    .type-seller {
      background: #fff3cd;
      color: #856404;
    }

    .new-badge {
      background: #dc3545;
      color: white;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      margin-left: 5px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .action-buttons {
      display: flex;
      gap: 5px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 8px;
      padding: 30px;
      max-width: 800px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }

    .modal-close:hover {
      color: #333;
    }

    .modal-body {
      margin-bottom: 20px;
    }

    .info-section {
      margin-bottom: 20px;
    }

    .info-section-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid #dee2e6;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .info-row {
      display: flex;
      margin-bottom: 12px;
    }

    .info-label {
      width: 140px;
      font-weight: 600;
      color: #666;
      font-size: 14px;
      flex-shrink: 0;
    }

    .info-value {
      flex: 1;
      color: #333;
      font-size: 14px;
      word-break: break-word;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
    }

    @media (max-width: 768px) {
      .info-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="pageTitle">ì‹ ì²­ ê´€ë¦¬</h1>

    <div class="filter-section">
      <div class="filter-group" id="typeFilterGroup" style="display: none;">
        <label>ìœ í˜•:</label>
        <select id="typeFilter">
          <option value="">ì „ì²´</option>
          <option value="buyer">ë§¤ìˆ˜</option>
          <option value="seller">ë§¤ë„</option>
        </select>
      </div>
      <div class="filter-group">
        <label>ìƒíƒœ:</label>
        <select id="statusFilter">
          <option value="">ì „ì²´</option>
          <option value="ëŒ€ê¸°ì¤‘">ëŒ€ê¸°ì¤‘</option>
          <option value="ì²˜ë¦¬ì¤‘">ì²˜ë¦¬ì¤‘</option>
          <option value="ì™„ë£Œ">ì™„ë£Œ</option>
          <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
        </select>
      </div>
      <div class="filter-group">
        <label>ê²€ìƒ‰:</label>
        <input type="text" id="searchInput" placeholder="íšŒì‚¬ëª…, íšŒì›ëª…, ì´ë©”ì¼ ê²€ìƒ‰">
      </div>
      <button class="btn btn-primary" onclick="applyFilters()">í•„í„° ì ìš©</button>
      <button class="btn btn-secondary" onclick="resetFilters()">ì´ˆê¸°í™”</button>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>ì‹ ì²­ ID</th>
            <th>ì‹ ì²­ì¼ì‹œ</th>
            <th>ìœ í˜•</th>
            <th>íšŒì›ëª…</th>
            <th>ì´ë©”ì¼</th>
            <th>íšŒì‚¬ëª…</th>
            <th>ìƒíƒœ</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="applicationTableBody">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </tbody>
      </table>
    </div>

    <div id="emptyState" class="empty-state" style="display: none;">
      <div class="empty-state-icon">ğŸ“‹</div>
      <div>ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>
  </div>

  <!-- ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
  <div id="detailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ì‹ ì²­ ìƒì„¸ ì •ë³´</div>
        <button class="modal-close" onclick="closeDetailModal()">&times;</button>
      </div>
      <div class="modal-body" id="detailModalBody">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDetailModal()">ë‹«ê¸°</button>
        <button class="btn btn-primary" id="updateStatusBtn" onclick="updateStatus()">ìƒíƒœ ë³€ê²½</button>
        <button class="btn btn-success" id="approveBtn" onclick="approveApplication()">ìŠ¹ì¸</button>
      </div>
    </div>
  </div>

  <script>
    let applications = [];
    let filteredApplications = [];
    let currentApplication = null;
    let currentType = null; // 'buyer' ë˜ëŠ” 'seller' ë˜ëŠ” null (ì „ì²´)

    // URL íŒŒë¼ë¯¸í„°ì—ì„œ type ê°€ì ¸ì˜¤ê¸°
    function getUrlParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // í˜ì´ì§€ ì œëª© ì„¤ì •
    function setPageTitle() {
      const titleElement = document.getElementById('pageTitle');
      if (currentType === 'seller') {
        titleElement.textContent = 'ë§¤ë„í˜„í™©';
      } else if (currentType === 'buyer') {
        titleElement.textContent = 'ë§¤ìˆ˜í˜„í™©';
      } else {
        titleElement.textContent = 'ì‹ ì²­ ê´€ë¦¬';
      }
    }

    // LocalStorageì—ì„œ ì‹ ì²­ ë°ì´í„° ë¡œë“œ
    function loadApplications() {
      // URL íŒŒë¼ë¯¸í„°ì—ì„œ type í™•ì¸
      const typeParam = getUrlParameter('type');
      currentType = typeParam === 'buyer' ? 'buyer' : (typeParam === 'seller' ? 'seller' : null);
      
      // í˜ì´ì§€ ì œëª© ì„¤ì •
      setPageTitle();
      
      // íƒ€ì… í•„í„° ê·¸ë£¹ í‘œì‹œ/ìˆ¨ê¹€ (íŠ¹ì • íƒ€ì… í˜ì´ì§€ì—ì„œëŠ” ìˆ¨ê¹€)
      const typeFilterGroup = document.getElementById('typeFilterGroup');
      if (currentType) {
        typeFilterGroup.style.display = 'none';
      } else {
        typeFilterGroup.style.display = 'flex';
      }
      
      const data = localStorage.getItem('mna_station_applications');
      applications = data ? JSON.parse(data) : [];
      
      // íƒ€ì…ì— ë”°ë¼ í•„í„°ë§
      if (currentType) {
        applications = applications.filter(app => app.type === currentType);
      }
      
      filteredApplications = [...applications];
      renderTable();
    }

    // í…Œì´ë¸” ë Œë”ë§
    function renderTable() {
      const tbody = document.getElementById('applicationTableBody');
      const emptyState = document.getElementById('emptyState');

      if (filteredApplications.length === 0) {
        tbody.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }

      emptyState.style.display = 'none';
      
      // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
      const sorted = [...filteredApplications].sort((a, b) => 
        new Date(b.createdAt) - new Date(a.createdAt)
      );

      tbody.innerHTML = sorted.map(app => {
        const date = new Date(app.createdAt);
        const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                       date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        
        const statusClass = getStatusClass(app.status);
        const typeClass = app.type === 'buyer' ? 'type-buyer' : 'type-seller';
        const typeText = app.type === 'buyer' ? 'ë§¤ìˆ˜' : 'ë§¤ë„';
        const isNew = new Date(app.createdAt) > new Date(Date.now() - 24 * 60 * 60 * 1000);

        return `
          <tr>
            <td>${app.id}${isNew ? '<span class="new-badge">NEW</span>' : ''}</td>
            <td>${dateStr}</td>
            <td><span class="type-badge ${typeClass}">${typeText}</span></td>
            <td>${app.userName}</td>
            <td>${app.userEmail}</td>
            <td>${app.company_name || '-'}</td>
            <td><span class="status-badge ${statusClass}">${app.status}</span></td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-primary btn-sm" onclick="showDetail('${app.id}')">ìƒì„¸</button>
                <button class="btn btn-danger btn-sm" onclick="deleteApplication('${app.id}')">ì‚­ì œ</button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    function getStatusClass(status) {
      const statusMap = {
        'ëŒ€ê¸°ì¤‘': 'status-waiting',
        'ì²˜ë¦¬ì¤‘': 'status-processing',
        'ì™„ë£Œ': 'status-completed',
        'ì·¨ì†Œ': 'status-cancelled'
      };
      return statusMap[status] || 'status-waiting';
    }

    // í•„í„° ì ìš©
    function applyFilters() {
      const statusFilter = document.getElementById('statusFilter').value;
      const typeFilter = document.getElementById('typeFilter').value;
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

      filteredApplications = applications.filter(app => {
        const matchStatus = !statusFilter || app.status === statusFilter;
        // currentTypeì´ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ typeFilterëŠ” ë¬´ì‹œí•˜ê³  currentTypeë§Œ ì‚¬ìš©
        const matchType = currentType ? app.type === currentType : (!typeFilter || app.type === typeFilter);
        const matchSearch = !searchTerm || 
          (app.company_name && app.company_name.toLowerCase().includes(searchTerm)) ||
          (app.userName && app.userName.toLowerCase().includes(searchTerm)) ||
          (app.userEmail && app.userEmail.toLowerCase().includes(searchTerm));

        return matchStatus && matchType && matchSearch;
      });

      renderTable();
    }

    // í•„í„° ì´ˆê¸°í™”
    function resetFilters() {
      document.getElementById('statusFilter').value = '';
      document.getElementById('typeFilter').value = '';
      document.getElementById('searchInput').value = '';
      filteredApplications = [...applications];
      renderTable();
    }

    // ìƒì„¸ ì •ë³´ ë³´ê¸°
    function showDetail(id) {
      currentApplication = applications.find(a => a.id === id);
      if (!currentApplication) return;

      const modalBody = document.getElementById('detailModalBody');
      const date = new Date(currentApplication.createdAt);
      const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                     date.toLocaleTimeString('ko-KR');

      let detailHTML = `
        <div class="info-section">
          <div class="info-section-title">ê¸°ë³¸ ì •ë³´</div>
          <div class="info-row">
            <div class="info-label">ì‹ ì²­ ID:</div>
            <div class="info-value">${currentApplication.id}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì‹ ì²­ì¼ì‹œ:</div>
            <div class="info-value">${dateStr}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ìœ í˜•:</div>
            <div class="info-value">${currentApplication.type === 'buyer' ? 'ë§¤ìˆ˜' : 'ë§¤ë„'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ìƒíƒœ:</div>
            <div class="info-value">
              <select id="statusSelect" style="padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px;">
                <option value="ëŒ€ê¸°ì¤‘" ${currentApplication.status === 'ëŒ€ê¸°ì¤‘' ? 'selected' : ''}>ëŒ€ê¸°ì¤‘</option>
                <option value="ì²˜ë¦¬ì¤‘" ${currentApplication.status === 'ì²˜ë¦¬ì¤‘' ? 'selected' : ''}>ì²˜ë¦¬ì¤‘</option>
                <option value="ì™„ë£Œ" ${currentApplication.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
                <option value="ì·¨ì†Œ" ${currentApplication.status === 'ì·¨ì†Œ' ? 'selected' : ''}>ì·¨ì†Œ</option>
              </select>
            </div>
          </div>
        </div>

        <div class="info-section">
          <div class="info-section-title">ë‹´ë‹¹ì ì •ë³´</div>
          <div class="info-row">
            <div class="info-label">ì„±ëª…:</div>
            <div class="info-value">${currentApplication.name || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">íœ´ëŒ€í°:</div>
            <div class="info-value">${currentApplication.hp || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì§ì±…:</div>
            <div class="info-value">${currentApplication.duty || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì´ë©”ì¼:</div>
            <div class="info-value">${currentApplication.email || '-'}</div>
          </div>
        </div>

        <div class="info-section">
          <div class="info-section-title">íšŒì‚¬ ì •ë³´</div>
          <div class="info-row">
            <div class="info-label">íšŒì‚¬ëª…:</div>
            <div class="info-value">${currentApplication.company_name || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì‚¬ì—…ìë²ˆí˜¸:</div>
            <div class="info-value">${currentApplication.company_ssn || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ê¸°ì—…í˜•íƒœ:</div>
            <div class="info-value">${currentApplication.company_type || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì†Œì¬ì§€:</div>
            <div class="info-value">${currentApplication.company_location || '-'}</div>
          </div>
      `;

      if (currentApplication.type === 'buyer') {
        detailHTML += `
          <div class="info-row">
            <div class="info-label">ë³´ìœ í˜„ê¸ˆ:</div>
            <div class="info-value">${currentApplication.cash || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">í¬ë§ ê¸°ì—…í˜•íƒœ:</div>
            <div class="info-value">${currentApplication.desire_company_type || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">í¬ë§ ì†Œì¬ì§€:</div>
            <div class="info-value">${currentApplication.desire_company_location || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì¸ìˆ˜ ì˜ˆì‚°:</div>
            <div class="info-value">${currentApplication.buying_price || '-'}</div>
          </div>
        `;
      } else {
        detailHTML += `
          <div class="info-row">
            <div class="info-label">íšŒì‚¬ ì—°ë½ì²˜:</div>
            <div class="info-value">${currentApplication.company_tel || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">í¬ë§ ë§¤ë„ì•¡:</div>
            <div class="info-value">${currentApplication.selling_price || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì–‘ë„ì§€ë¶„:</div>
            <div class="info-value">${currentApplication.share || '-'}</div>
          </div>
        `;
      }

      detailHTML += `
        </div>

        <div class="info-section">
          <div class="info-section-title">ì—…ì¢… ì •ë³´</div>
          <div class="info-row">
            <div class="info-label">ëŒ€ë¶„ë¥˜:</div>
            <div class="info-value">${currentApplication.category_big || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì¤‘ë¶„ë¥˜:</div>
            <div class="info-value">${currentApplication.category_mid || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì†Œë¶„ë¥˜:</div>
            <div class="info-value">${currentApplication.category_sml || '-'}</div>
          </div>
      `;

      if (currentApplication.type === 'buyer') {
        detailHTML += `
          <div class="info-row">
            <div class="info-label">ì„¸ë¶€ì•„ì´í…œ1:</div>
            <div class="info-value">${currentApplication.detail_item1 || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì„¸ë¶€ì•„ì´í…œ2:</div>
            <div class="info-value">${currentApplication.detail_item2 || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ì„¸ë¶€ì•„ì´í…œ3:</div>
            <div class="info-value">${currentApplication.detail_item3 || '-'}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ê²€ìƒ‰í‚¤ì›Œë“œ:</div>
            <div class="info-value">${currentApplication.keyword || '-'}</div>
          </div>
        `;
      }

      detailHTML += `
        </div>
      `;

      modalBody.innerHTML = detailHTML;
      document.getElementById('detailModal').classList.add('active');
    }

    // ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeDetailModal() {
      document.getElementById('detailModal').classList.remove('active');
      currentApplication = null;
    }

    // ìƒíƒœ ë³€ê²½
    function updateStatus() {
      if (!currentApplication) return;

      const newStatus = document.getElementById('statusSelect').value;
      const index = applications.findIndex(a => a.id === currentApplication.id);
      
      if (index !== -1) {
        applications[index].status = newStatus;
        currentApplication.status = newStatus;
        localStorage.setItem('mna_station_applications', JSON.stringify(applications));
        
        applyFilters();
        closeDetailModal();
        alert('ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ì‹ ì²­ ìŠ¹ì¸ (listingsì— ì¶”ê°€)
    function approveApplication() {
      if (!currentApplication) return;

      if (currentApplication.status === 'ì™„ë£Œ') {
        alert('ì´ë¯¸ ìŠ¹ì¸ëœ ì‹ ì²­ì…ë‹ˆë‹¤.');
        return;
      }

      if (!confirm('ì´ ì‹ ì²­ì„ ìŠ¹ì¸í•˜ê³  listingsì— ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      // listings ë°ì´í„° ìƒì„±
      const listingData = {
        id: currentApplication.id,
        category: currentApplication.category_mid || currentApplication.category_big || 'ê¸°íƒ€',
        name: currentApplication.company_name,
        type: currentApplication.company_type || (currentApplication.type === 'buyer' ? currentApplication.desire_company_type : 'ì¤‘ì†Œê¸°ì—…') || 'ì¤‘ì†Œê¸°ì—…',
        priceRange: currentApplication.type === 'buyer' 
          ? (currentApplication.buying_price || '0~0ì–µ')
          : (currentApplication.selling_price || '0~0ì–µ'),
        capital: currentApplication.type === 'buyer' 
          ? (currentApplication.cash || '0ì–µì›')
          : '0ì–µì›',
        isNew: false,
        applicationId: currentApplication.id
      };

      // listings ë°ì´í„°ì— ì¶”ê°€
      if (currentApplication.type === 'buyer') {
        const buyersListings = JSON.parse(localStorage.getItem('mna_station_buyers_listings') || '[]');
        buyersListings.unshift(listingData);
        localStorage.setItem('mna_station_buyers_listings', JSON.stringify(buyersListings));
      } else {
        const sellersListings = JSON.parse(localStorage.getItem('mna_station_sellers_listings') || '[]');
        sellersListings.unshift(listingData);
        localStorage.setItem('mna_station_sellers_listings', JSON.stringify(sellersListings));
      }

      // ìƒíƒœë¥¼ ì™„ë£Œë¡œ ë³€ê²½
      const index = applications.findIndex(a => a.id === currentApplication.id);
      if (index !== -1) {
        applications[index].status = 'ì™„ë£Œ';
        currentApplication.status = 'ì™„ë£Œ';
        localStorage.setItem('mna_station_applications', JSON.stringify(applications));
      }

      applyFilters();
      closeDetailModal();
      alert('ì‹ ì²­ì´ ìŠ¹ì¸ë˜ì–´ listingsì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ì‹ ì²­ ì‚­ì œ
    function deleteApplication(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      applications = applications.filter(a => a.id !== id);
      localStorage.setItem('mna_station_applications', JSON.stringify(applications));
      
      applyFilters();
      alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ë”ë¯¸ë°ì´í„° ê´€ë¦¬
    function manageDummyData() {
      const buyersDummy = [
        { id: 'MN-2025-101', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ëŒ€í˜• IT ê·¸ë£¹', type: 'ëŒ€ê¸°ì—…', priceRange: '10~30ì–µ', capital: '500ì–µì›' },
        { id: 'MN-2025-102', category: 'ì œì¡°ì—…', name: 'ìë™ì°¨ ë¶€í’ˆ ê¸°ì—…', type: 'ëŒ€ê¸°ì—…', priceRange: '10~30ì–µ', capital: '800ì–µì›' },
        { id: 'MN-2025-103', category: 'ì„œë¹„ìŠ¤ì—…', name: 'í—¬ìŠ¤ì¼€ì–´ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '10~30ì–µ', capital: '300ì–µì›' },
        { id: 'MN-2025-104', category: 'ìœ í†µ/ë¬¼ë¥˜', name: 'ë¬¼ë¥˜ ëŒ€ê¸°ì—…', type: 'ëŒ€ê¸°ì—…', priceRange: '30~50ì–µ', capital: '400ì–µì›' },
        { id: 'MN-2025-105', category: 'ì—”í„°í…Œì¸ë¨¼íŠ¸', name: 'ê²Œì„ í¼ë¸”ë¦¬ì…”', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '30~50ì–µ', capital: '600ì–µì›' },
        { id: 'MN-2025-106', category: 'ê¸ˆìœµ/í•€í…Œí¬', name: 'ê¸ˆìœµê·¸ë£¹', type: 'ëŒ€ê¸°ì—…', priceRange: '30~50ì–µ', capital: '1000ì–µì›' },
        { id: 'MN-2025-107', category: 'êµìœ¡/ì—ë“€í…Œí¬', name: 'êµìœ¡ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '50~70ì–µ', capital: '250ì–µì›' },
        { id: 'MN-2025-108', category: 'ì œì¡°ì—…', name: 'í™”í•™ ì œì¡° ê¸°ì—…', type: 'ëŒ€ê¸°ì—…', priceRange: '50~70ì–µ', capital: '700ì–µì›' },
        { id: 'MN-2025-109', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ì»¨ì„¤íŒ… ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '50~70ì–µ', capital: '350ì–µì›' },
        { id: 'MN-2025-110', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ê·¸ë£¹', type: 'ëŒ€ê¸°ì—…', priceRange: '70~90ì–µ', capital: '450ì–µì›' },
        { id: 'MN-2025-111', category: 'ì œì¡°ì—…', name: 'ë°˜ë„ì²´ ì œì¡° ê¸°ì—…', type: 'ëŒ€ê¸°ì—…', priceRange: '70~90ì–µ', capital: '1200ì–µì›' },
        { id: 'MN-2025-112', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ë””ì§€í„¸ ë§ˆì¼€íŒ… ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '70~90ì–µ', capital: '200ì–µì›' },
        { id: 'MN-2025-113', category: 'ìœ í†µ/ë¬¼ë¥˜', name: 'ì „ììƒê±°ë˜ ê·¸ë£¹', type: 'ëŒ€ê¸°ì—…', priceRange: '90~110ì–µ', capital: '550ì–µì›' },
        { id: 'MN-2025-114', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ëª¨ë°”ì¼ í”Œë«í¼ ê¸°ì—…', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '90~110ì–µ', capital: '280ì–µì›' },
        { id: 'MN-2025-115', category: 'ì œì¡°ì—…', name: 'ì˜ë£Œê¸°ê¸° ì œì¡° ê·¸ë£¹', type: 'ëŒ€ê¸°ì—…', priceRange: '90~110ì–µ', capital: '650ì–µì›' },
        { id: 'MN-2025-116', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ë¶€ë™ì‚° í”Œë«í¼ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '110~130ì–µ', capital: '320ì–µì›' },
        { id: 'MN-2025-117', category: 'ê¸ˆìœµ/í•€í…Œí¬', name: 'ì•”í˜¸í™”í ê±°ë˜ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '110~130ì–µ', capital: '380ì–µì›' },
        { id: 'MN-2025-118', category: 'êµìœ¡/ì—ë“€í…Œí¬', name: 'ì˜¨ë¼ì¸ êµìœ¡ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '110~130ì–µ', capital: '220ì–µì›' },
        { id: 'MN-2025-119', category: 'ì œì¡°ì—…', name: 'ì „ê¸°ì°¨ ë°°í„°ë¦¬ ê·¸ë£¹', type: 'ëŒ€ê¸°ì—…', priceRange: '130~150ì–µ', capital: '1500ì–µì›' },
        { id: 'MN-2025-120', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ë¸”ë¡ì²´ì¸ ì†”ë£¨ì…˜ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '130~150ì–µ', capital: '290ì–µì›' },
        { id: 'MN-2025-121', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ìŒì‹ ë°°ë‹¬ í”Œë«í¼ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '130~150ì–µ', capital: '260ì–µì›' },
        { id: 'MN-2025-122', category: 'ìœ í†µ/ë¬¼ë¥˜', name: 'í•´ì™¸ì§êµ¬ í”Œë«í¼ ê·¸ë£¹', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '150~170ì–µ', capital: '150ì–µì›' },
        { id: 'MN-2025-123', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'AI ìŒì„±ì¸ì‹ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '150~170ì–µ', capital: '310ì–µì›' },
        { id: 'MN-2025-124', category: 'ì œì¡°ì—…', name: 'ìŠ¤ë§ˆíŠ¸í™ˆ ê¸°ê¸° ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '150~170ì–µ', capital: '240ì–µì›' },
        { id: 'MN-2025-125', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ì—¬í–‰ ì˜ˆì•½ í”Œë«í¼ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '170~190ì–µ', capital: '270ì–µì›' },
        { id: 'MN-2025-126', category: 'ê¸ˆìœµ/í•€í…Œí¬', name: 'P2P ê¸ˆìœµ í”Œë«í¼ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '170~190ì–µ', capital: '330ì–µì›' },
        { id: 'MN-2025-127', category: 'êµìœ¡/ì—ë“€í…Œí¬', name: 'ì˜¨ë¼ì¸ í•™ì› ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '170~190ì–µ', capital: '210ì–µì›' },
        { id: 'MN-2025-128', category: 'ì œì¡°ì—…', name: 'ë¡œë´‡ ì œì¡° ê·¸ë£¹', type: 'ëŒ€ê¸°ì—…', priceRange: '190~200ì–µ', capital: '900ì–µì›' },
        { id: 'MN-2025-129', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ì‚¬ì´ë²„ ë³´ì•ˆ ì†”ë£¨ì…˜ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '190~200ì–µ', capital: '360ì–µì›' },
        { id: 'MN-2025-130', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ê³µìœ ê²½ì œ í”Œë«í¼ ê·¸ë£¹', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '190~200ì–µ', capital: '340ì–µì›' }
      ];

      const sellersDummy = [
        { id: 'MN-2025-001', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ê¸€ë¡œë²Œ AI ìŠ¤íƒ€íŠ¸ì—…', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '0~20ì–µ', capital: '2ì–µì›' },
        { id: 'MN-2025-002', category: 'ì œì¡°ì—…', name: 'ì „ìë¶€í’ˆ ì œì¡°ì‚¬', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '0~20ì–µ', capital: '3ì–µì›' },
        { id: 'MN-2025-003', category: 'ì„œë¹„ìŠ¤ì—…', name: 'í—¬ìŠ¤ì¼€ì–´ í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '0~20ì–µ', capital: '2.5ì–µì›' },
        { id: 'MN-2025-004', category: 'ìœ í†µ/ë¬¼ë¥˜', name: 'ë¬¼ë¥˜ ì†”ë£¨ì…˜ ê¸°ì—…', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '20~40ì–µ', capital: '4ì–µì›' },
        { id: 'MN-2025-005', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ê²Œì„ ê°œë°œ ìŠ¤íŠœë””ì˜¤', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '20~40ì–µ', capital: '5ì–µì›' },
        { id: 'MN-2025-006', category: 'ê¸ˆìœµ/í•€í…Œí¬', name: 'í•€í…Œí¬ ìŠ¤íƒ€íŠ¸ì—…', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '20~40ì–µ', capital: '4.5ì–µì›' },
        { id: 'MN-2025-007', category: 'êµìœ¡/ì—ë“€í…Œí¬', name: 'ì˜¨ë¼ì¸ êµìœ¡ í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '40~60ì–µ', capital: '6ì–µì›' },
        { id: 'MN-2025-008', category: 'ì œì¡°ì—…', name: 'ì¹œí™˜ê²½ ì†Œì¬ ì œì¡°ì‚¬', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '40~60ì–µ', capital: '8ì–µì›' },
        { id: 'MN-2025-009', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ì»¨ì„¤íŒ… ê¸°ì—…', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '40~60ì–µ', capital: '7ì–µì›' },
        { id: 'MN-2025-010', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ê¸°ì—…', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '60~80ì–µ', capital: '9ì–µì›' },
        { id: 'MN-2025-011', category: 'ì œì¡°ì—…', name: 'ë°˜ë„ì²´ ë¶€í’ˆ ì œì¡°ì‚¬', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '60~80ì–µ', capital: '12ì–µì›' },
        { id: 'MN-2025-012', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ë””ì§€í„¸ ë§ˆì¼€íŒ… ëŒ€í–‰ì‚¬', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '60~80ì–µ', capital: '10ì–µì›' },
        { id: 'MN-2025-013', category: 'ìœ í†µ/ë¬¼ë¥˜', name: 'ì „ììƒê±°ë˜ í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '80~100ì–µ', capital: '11ì–µì›' },
        { id: 'MN-2025-014', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ëª¨ë°”ì¼ ì•± ê°œë°œì‚¬', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '80~100ì–µ', capital: '12ì–µì›' },
        { id: 'MN-2025-015', category: 'ì œì¡°ì—…', name: 'ë°”ì´ì˜¤ ì˜ë£Œê¸°ê¸° ì œì¡°ì‚¬', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '80~100ì–µ', capital: '15ì–µì›' },
        { id: 'MN-2025-016', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ë¶€ë™ì‚° í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '100~120ì–µ', capital: '13ì–µì›' },
        { id: 'MN-2025-017', category: 'ê¸ˆìœµ/í•€í…Œí¬', name: 'ì•”í˜¸í™”í ê±°ë˜ì†Œ', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '100~120ì–µ', capital: '14ì–µì›' },
        { id: 'MN-2025-018', category: 'êµìœ¡/ì—ë“€í…Œí¬', name: 'ì½”ë”© êµìœ¡ í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '100~120ì–µ', capital: '15ì–µì›' },
        { id: 'MN-2025-019', category: 'ì œì¡°ì—…', name: 'ì „ê¸°ì°¨ ë°°í„°ë¦¬ ì œì¡°ì‚¬', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '120~140ì–µ', capital: '18ì–µì›' },
        { id: 'MN-2025-020', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ë¸”ë¡ì²´ì¸ ì†”ë£¨ì…˜ ê¸°ì—…', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '120~140ì–µ', capital: '16ì–µì›' },
        { id: 'MN-2025-021', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ìŒì‹ ë°°ë‹¬ í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '120~140ì–µ', capital: '17ì–µì›' },
        { id: 'MN-2025-022', category: 'ìœ í†µ/ë¬¼ë¥˜', name: 'í•´ì™¸ì§êµ¬ ëŒ€í–‰ ì„œë¹„ìŠ¤', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '140~160ì–µ', capital: '18ì–µì›' },
        { id: 'MN-2025-023', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ì¸ê³µì§€ëŠ¥ ìŒì„±ì¸ì‹ ê¸°ì—…', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '140~160ì–µ', capital: '20ì–µì›' },
        { id: 'MN-2025-024', category: 'ì œì¡°ì—…', name: 'ìŠ¤ë§ˆíŠ¸í™ˆ ê¸°ê¸° ì œì¡°ì‚¬', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '140~160ì–µ', capital: '19ì–µì›' },
        { id: 'MN-2025-025', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ì—¬í–‰ ì˜ˆì•½ í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '160~180ì–µ', capital: '20ì–µì›' },
        { id: 'MN-2025-026', category: 'ê¸ˆìœµ/í•€í…Œí¬', name: 'P2P ê¸ˆìœµ í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '160~180ì–µ', capital: '22ì–µì›' },
        { id: 'MN-2025-027', category: 'êµìœ¡/ì—ë“€í…Œí¬', name: 'ì˜¨ë¼ì¸ í•™ì› í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '160~180ì–µ', capital: '21ì–µì›' },
        { id: 'MN-2025-028', category: 'ì œì¡°ì—…', name: 'ë¡œë´‡ ì œì¡° ê¸°ì—…', type: 'ì¤‘ê²¬ê¸°ì—…', priceRange: '180~200ì–µ', capital: '25ì–µì›' },
        { id: 'MN-2025-029', category: 'IT/ì†Œí”„íŠ¸ì›¨ì–´', name: 'ì‚¬ì´ë²„ ë³´ì•ˆ ì†”ë£¨ì…˜ ê¸°ì—…', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '180~200ì–µ', capital: '23ì–µì›' },
        { id: 'MN-2025-030', category: 'ì„œë¹„ìŠ¤ì—…', name: 'ê³µìœ ê²½ì œ í”Œë«í¼', type: 'ì¤‘ì†Œê¸°ì—…', priceRange: '180~200ì–µ', capital: '24ì–µì›' }
      ];

      // ë”ë¯¸ë°ì´í„°ë¥¼ ê´€ë¦¬ìš© ë°ì´í„°ë¡œ ë³€í™˜
      const buyersDummyApplications = buyersDummy.map(item => ({
        ...item,
        type: 'buyer',
        status: 'ì™„ë£Œ',
        createdAt: new Date().toISOString(),
        userId: 'system',
        userName: 'ì‹œìŠ¤í…œ',
        userEmail: 'system@mnastation.com',
        isDummy: true,
        company_name: item.name
      }));

      const sellersDummyApplications = sellersDummy.map(item => ({
        ...item,
        type: 'seller',
        status: 'ì™„ë£Œ',
        createdAt: new Date().toISOString(),
        userId: 'system',
        userName: 'ì‹œìŠ¤í…œ',
        userEmail: 'system@mnastation.com',
        isDummy: true,
        company_name: item.name
      }));

      // ê¸°ì¡´ ë”ë¯¸ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì¶”ê°€
      const existingDummy = applications.filter(a => a.isDummy);
      if (existingDummy.length === 0) {
        applications = [...applications, ...buyersDummyApplications, ...sellersDummyApplications];
        localStorage.setItem('mna_station_applications', JSON.stringify(applications));
        
        // listings ë°ì´í„°ì—ë„ ì¶”ê°€
        const buyersListings = JSON.parse(localStorage.getItem('mna_station_buyers_listings') || '[]');
        const sellersListings = JSON.parse(localStorage.getItem('mna_station_sellers_listings') || '[]');
        
        buyersDummy.forEach(item => {
          if (!buyersListings.find(l => l.id === item.id)) {
            buyersListings.push({...item, isNew: false});
          }
        });
        
        sellersDummy.forEach(item => {
          if (!sellersListings.find(l => l.id === item.id)) {
            sellersListings.push({...item, isNew: false});
          }
        });
        
        localStorage.setItem('mna_station_buyers_listings', JSON.stringify(buyersListings));
        localStorage.setItem('mna_station_sellers_listings', JSON.stringify(sellersListings));
        
        alert('ê¸°ì¡´ ë”ë¯¸ë°ì´í„°ê°€ ê´€ë¦¬ ì‹œìŠ¤í…œì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        loadApplications();
      } else {
        alert('ë”ë¯¸ë°ì´í„°ëŠ” ì´ë¯¸ ê´€ë¦¬ ì‹œìŠ¤í…œì— ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
      }
    }

    // ê²€ìƒ‰ ì…ë ¥ í•„ë“œì—ì„œ Enter í‚¤ ì²˜ë¦¬
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        applyFilters();
      }
    });

    // ì´ˆê¸° ë¡œë“œ
    loadApplications();
  </script>
</body>
</html>

