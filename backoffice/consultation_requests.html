<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìƒë‹´ ì‹ ì²­ ê´€ë¦¬ - M&A STATION</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", "Malgun Gothic", "Apple SD Gothic Neo", sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 30px;
    }

    h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #4db7ff;
    }

    .filter-section {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filter-group label {
      font-size: 14px;
      color: #666;
      white-space: nowrap;
    }

    .filter-group select,
    .filter-group input {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .filter-group input {
      min-width: 200px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #4db7ff;
      color: white;
    }

    .btn-primary:hover {
      background: #1f6fe5;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    thead {
      background: #f8f9fa;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #dee2e6;
    }

    th {
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    td {
      font-size: 13px;
      color: #666;
    }

    tbody tr:hover {
      background: #f8f9fa;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-waiting {
      background: #fff3cd;
      color: #856404;
    }

    .status-processing {
      background: #d1ecf1;
      color: #0c5460;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    .status-cancelled {
      background: #f8d7da;
      color: #721c24;
    }

    .type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
      background: #e9ecef;
      color: #495057;
    }

    .type-buyer {
      background: #cfe2ff;
      color: #084298;
    }

    .type-seller {
      background: #fff3cd;
      color: #856404;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .action-buttons {
      display: flex;
      gap: 5px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 8px;
      padding: 30px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }

    .modal-close:hover {
      color: #333;
    }

    .modal-body {
      margin-bottom: 20px;
    }

    .info-row {
      display: flex;
      margin-bottom: 15px;
    }

    .info-label {
      width: 120px;
      font-weight: 600;
      color: #666;
      font-size: 14px;
    }

    .info-value {
      flex: 1;
      color: #333;
      font-size: 14px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding-top: 20px;
      border-top: 1px solid #dee2e6;
    }

    .pagination {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-top: 20px;
    }

    .pagination button {
      padding: 6px 12px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer;
      border-radius: 4px;
    }

    .pagination button:hover {
      background: #f8f9fa;
    }

    .pagination button.active {
      background: #4db7ff;
      color: white;
      border-color: #4db7ff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ìƒë‹´ ì‹ ì²­ ê´€ë¦¬</h1>

    <div class="filter-section">
      <div class="filter-group">
        <label>ìƒíƒœ:</label>
        <select id="statusFilter">
          <option value="">ì „ì²´</option>
          <option value="ëŒ€ê¸°ì¤‘">ëŒ€ê¸°ì¤‘</option>
          <option value="ì²˜ë¦¬ì¤‘">ì²˜ë¦¬ì¤‘</option>
          <option value="ì™„ë£Œ">ì™„ë£Œ</option>
          <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
        </select>
      </div>
      <div class="filter-group">
        <label>ìœ í˜•:</label>
        <select id="typeFilter">
          <option value="">ì „ì²´</option>
          <option value="buyer">ë§¤ìˆ˜</option>
          <option value="seller">ë§¤ë„</option>
        </select>
      </div>
      <div class="filter-group">
        <label>ê²€ìƒ‰:</label>
        <input type="text" id="searchInput" placeholder="ê¸°ì—…ëª…, íšŒì›ëª…, ì´ë©”ì¼ ê²€ìƒ‰">
      </div>
      <button class="btn btn-primary" onclick="applyFilters()">í•„í„° ì ìš©</button>
      <button class="btn btn-secondary" onclick="resetFilters()">ì´ˆê¸°í™”</button>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>ì‹ ì²­ ID</th>
            <th>ì‹ ì²­ì¼ì‹œ</th>
            <th>íšŒì›ëª…</th>
            <th>ì´ë©”ì¼</th>
            <th>ê¸°ì—…ëª…</th>
            <th>ìœ í˜•</th>
            <th>ìƒíƒœ</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="consultationTableBody">
          <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </tbody>
      </table>
    </div>

    <div id="emptyState" class="empty-state" style="display: none;">
      <div class="empty-state-icon">ğŸ“‹</div>
      <div>ìƒë‹´ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>
  </div>

  <!-- ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
  <div id="detailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ìƒë‹´ ì‹ ì²­ ìƒì„¸ ì •ë³´</div>
        <button class="modal-close" onclick="closeDetailModal()">&times;</button>
      </div>
      <div class="modal-body" id="detailModalBody">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDetailModal()">ë‹«ê¸°</button>
        <button class="btn btn-primary" id="updateStatusBtn" onclick="updateStatus()">ìƒíƒœ ë³€ê²½</button>
      </div>
    </div>
  </div>

  <script>
    let consultations = [];
    let filteredConsultations = [];
    let currentConsultation = null;

    // LocalStorageì—ì„œ ìƒë‹´ ì‹ ì²­ ë°ì´í„° ë¡œë“œ
    function loadConsultations() {
      const data = localStorage.getItem('mna_station_consultations');
      consultations = data ? JSON.parse(data) : [];
      filteredConsultations = [...consultations];
      renderTable();
    }

    // í…Œì´ë¸” ë Œë”ë§
    function renderTable() {
      const tbody = document.getElementById('consultationTableBody');
      const emptyState = document.getElementById('emptyState');

      if (filteredConsultations.length === 0) {
        tbody.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }

      emptyState.style.display = 'none';
      
      // ìµœì‹ ìˆœìœ¼ë¡œ ì •ë ¬
      const sorted = [...filteredConsultations].sort((a, b) => 
        new Date(b.createdAt) - new Date(a.createdAt)
      );

      tbody.innerHTML = sorted.map(cons => {
        const date = new Date(cons.createdAt);
        const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                       date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        
        const statusClass = getStatusClass(cons.status);
        const typeClass = cons.consultationType === 'buyer' ? 'type-buyer' : 'type-seller';
        const typeText = cons.consultationType === 'buyer' ? 'ë§¤ìˆ˜' : 'ë§¤ë„';

        return `
          <tr>
            <td>${cons.id}</td>
            <td>${dateStr}</td>
            <td>${cons.userName}</td>
            <td>${cons.userEmail}</td>
            <td>${cons.companyName}</td>
            <td><span class="type-badge ${typeClass}">${typeText}</span></td>
            <td><span class="status-badge ${statusClass}">${cons.status}</span></td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-primary btn-sm" onclick="showDetail('${cons.id}')">ìƒì„¸</button>
                <button class="btn btn-danger btn-sm" onclick="deleteConsultation('${cons.id}')">ì‚­ì œ</button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    function getStatusClass(status) {
      const statusMap = {
        'ëŒ€ê¸°ì¤‘': 'status-waiting',
        'ì²˜ë¦¬ì¤‘': 'status-processing',
        'ì™„ë£Œ': 'status-completed',
        'ì·¨ì†Œ': 'status-cancelled'
      };
      return statusMap[status] || 'status-waiting';
    }

    // í•„í„° ì ìš©
    function applyFilters() {
      const statusFilter = document.getElementById('statusFilter').value;
      const typeFilter = document.getElementById('typeFilter').value;
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

      filteredConsultations = consultations.filter(cons => {
        const matchStatus = !statusFilter || cons.status === statusFilter;
        const matchType = !typeFilter || cons.consultationType === typeFilter;
        const matchSearch = !searchTerm || 
          cons.companyName.toLowerCase().includes(searchTerm) ||
          cons.userName.toLowerCase().includes(searchTerm) ||
          cons.userEmail.toLowerCase().includes(searchTerm);

        return matchStatus && matchType && matchSearch;
      });

      renderTable();
    }

    // í•„í„° ì´ˆê¸°í™”
    function resetFilters() {
      document.getElementById('statusFilter').value = '';
      document.getElementById('typeFilter').value = '';
      document.getElementById('searchInput').value = '';
      filteredConsultations = [...consultations];
      renderTable();
    }

    // ìƒì„¸ ì •ë³´ ë³´ê¸°
    function showDetail(id) {
      currentConsultation = consultations.find(c => c.id === id);
      if (!currentConsultation) return;

      const modalBody = document.getElementById('detailModalBody');
      const date = new Date(currentConsultation.createdAt);
      const dateStr = date.toLocaleDateString('ko-KR') + ' ' + 
                     date.toLocaleTimeString('ko-KR');

      modalBody.innerHTML = `
        <div class="info-row">
          <div class="info-label">ì‹ ì²­ ID:</div>
          <div class="info-value">${currentConsultation.id}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ì‹ ì²­ì¼ì‹œ:</div>
          <div class="info-value">${dateStr}</div>
        </div>
        <div class="info-row">
          <div class="info-label">íšŒì›ëª…:</div>
          <div class="info-value">${currentConsultation.userName}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ì´ë©”ì¼:</div>
          <div class="info-value">${currentConsultation.userEmail}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ê¸°ì—… ID:</div>
          <div class="info-value">${currentConsultation.companyId}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ê¸°ì—…ëª…:</div>
          <div class="info-value">${currentConsultation.companyName}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ê¸°ì—… í˜•íƒœ:</div>
          <div class="info-value">${currentConsultation.companyType}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ì—…ì¢…:</div>
          <div class="info-value">${currentConsultation.companyCategory}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ê°€ê²© ë²”ìœ„:</div>
          <div class="info-value">${currentConsultation.priceRange}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ìë³¸ê¸ˆ:</div>
          <div class="info-value">${currentConsultation.capital}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ìƒë‹´ ìœ í˜•:</div>
          <div class="info-value">${currentConsultation.consultationType === 'buyer' ? 'ë§¤ìˆ˜' : 'ë§¤ë„'}</div>
        </div>
        <div class="info-row">
          <div class="info-label">ìƒíƒœ:</div>
          <div class="info-value">
            <select id="statusSelect" style="padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="ëŒ€ê¸°ì¤‘" ${currentConsultation.status === 'ëŒ€ê¸°ì¤‘' ? 'selected' : ''}>ëŒ€ê¸°ì¤‘</option>
              <option value="ì²˜ë¦¬ì¤‘" ${currentConsultation.status === 'ì²˜ë¦¬ì¤‘' ? 'selected' : ''}>ì²˜ë¦¬ì¤‘</option>
              <option value="ì™„ë£Œ" ${currentConsultation.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
              <option value="ì·¨ì†Œ" ${currentConsultation.status === 'ì·¨ì†Œ' ? 'selected' : ''}>ì·¨ì†Œ</option>
            </select>
          </div>
        </div>
        <div class="info-row">
          <div class="info-label">ì‹ ì²­ í˜ì´ì§€:</div>
          <div class="info-value">${currentConsultation.page}</div>
        </div>
      `;

      document.getElementById('detailModal').classList.add('active');
    }

    // ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeDetailModal() {
      document.getElementById('detailModal').classList.remove('active');
      currentConsultation = null;
    }

    // ìƒíƒœ ë³€ê²½
    function updateStatus() {
      if (!currentConsultation) return;

      const newStatus = document.getElementById('statusSelect').value;
      const index = consultations.findIndex(c => c.id === currentConsultation.id);
      
      if (index !== -1) {
        consultations[index].status = newStatus;
        currentConsultation.status = newStatus;
        localStorage.setItem('mna_station_consultations', JSON.stringify(consultations));
        
        applyFilters();
        closeDetailModal();
        alert('ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ìƒë‹´ ì‹ ì²­ ì‚­ì œ
    function deleteConsultation(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      consultations = consultations.filter(c => c.id !== id);
      localStorage.setItem('mna_station_consultations', JSON.stringify(consultations));
      
      applyFilters();
      alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ê²€ìƒ‰ ì…ë ¥ í•„ë“œì—ì„œ Enter í‚¤ ì²˜ë¦¬
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        applyFilters();
      }
    });

    // ì´ˆê¸° ë¡œë“œ
    loadConsultations();
  </script>
</body>
</html>

